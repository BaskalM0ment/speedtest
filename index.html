<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Orkla-Style Speed Test</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f0f2f5;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 50px 20px;
  }
  h1 {
    margin-bottom: 20px;
  }
  canvas {
    background: white;
    border-radius: 50%;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
  }
  #info {
    margin-top: 30px;
    font-size: 18px;
  }
  #start {
    padding: 10px 20px;
    font-size: 18px;
    border: none;
    border-radius: 8px;
    background: #0078ff;
    color: #fff;
    cursor: pointer;
    margin-bottom: 20px;
  }
  #start:hover { background:#005fcc; }
</style>
</head>
<body>
<h1>Network Speed Test</h1>
<button id="start">Start Test</button>
<canvas id="speedometer" width="300" height="300"></canvas>
<div id="info">
  <div id="ping">Ping: - ms</div>
  <div id="download">Download: - Mbps</div>
</div>

<script>
const downloadUrl = "https://speed.hetzner.de/1MB.bin"; // small test file
const pingUrl = "https://www.google.com/images/branding/googlelogo/2x/googlelogo_light_color_92x30dp.png"; // small ping file

const canvas = document.getElementById("speedometer");
const ctx = canvas.getContext("2d");
const center = canvas.width/2;

function drawSpeedometer(speed) {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Background circle
  ctx.beginPath();
  ctx.arc(center, center, 130, 0, 2*Math.PI);
  ctx.fillStyle = "#e6e6e6";
  ctx.fill();

  // Draw arc representing speed
  const maxSpeed = 100; // max Mbps
  let endAngle = (speed/maxSpeed)*Math.PI*1.5 + Math.PI*0.75; 
  ctx.beginPath();
  ctx.arc(center, center, 120, Math.PI*0.75, endAngle);
  ctx.lineWidth = 15;
  ctx.strokeStyle = "#0078ff";
  ctx.stroke();

  // Speed text
  ctx.font = "32px Arial";
  ctx.fillStyle = "#000";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.fillText(speed.toFixed(1) + " Mbps", center, center);
}

async function testPing() {
  const pingDiv = document.getElementById("ping");
  let pingResults = [];
  for(let i=0;i<5;i++){
    const start = performance.now();
    try {
      await fetch(pingUrl + "?cache=" + Math.random(), { method: "HEAD" });
      const end = performance.now();
      pingResults.push(Math.round(end-start));
    } catch {
      pingResults.push(1000);
    }
    pingDiv.textContent = "Ping: " + pingResults[pingResults.length-1] + " ms";
    await new Promise(r=>setTimeout(r,200));
  }
  const avgPing = Math.round(pingResults.reduce((a,b)=>a+b)/pingResults.length);
  pingDiv.textContent = `Ping: ${avgPing} ms`;
}

async function testDownloadSpeed() {
  const speedDiv = document.getElementById("download");
  const startTime = performance.now();
  try {
    const response = await fetch(downloadUrl + "?cache=" + Math.random());
    const reader = response.body.getReader();
    let received = 0;
    const contentLength = +response.headers.get("Content-Length") || 1024*1024;
    while(true){
      const {done,value} = await reader.read();
      if(done) break;
      received += value.length;
      const duration = (performance.now() - startTime)/1000;
      const bits = received*8;
      const mbps = bits/duration/1024/1024;
      speedDiv.textContent = `Download: ${mbps.toFixed(2)} Mbps`;
      drawSpeedometer(Math.min(mbps,100)); // cap at 100 Mbps
      await new Promise(r=>setTimeout(r,50));
    }
  } catch(err) {
    speedDiv.textContent = "Download: Error";
    drawSpeedometer(0);
  }
}

document.getElementById("start").addEventListener("click", async () => {
  document.getElementById("ping").textContent = "Ping: Testing...";
  document.getElementById("download").textContent = "Download: Testing...";
  drawSpeedometer(0);
  await testPing();
  await testDownloadSpeed();
});
</script>
</body>
</html>
